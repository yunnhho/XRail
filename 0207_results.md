# XRail Project 개발 결과 요약 (2026-02-07)

## 1. 핵심 문제 해결 및 안정화 (Critical Fixes & Stability)

*   **Hibernate 프록시 객체 처리 (ClassCastException 해결)**
    *   **문제:** 비회원 예매 확인 및 관리자 페이지 사용자 정보 조회 시, `instanceof`나 강제 형변환이 프록시 객체(`User$HibernateProxy`)를 인식하지 못해 오류 발생.
    *   **해결:** `Hibernate.unproxy()`를 사용하여 실제 엔티티를 명시적으로 로드하고, `UserRole` 필드를 통한 안전한 타입 체크 로직을 적용.

*   **비회원 결제 및 AccessCode 누락 수정**
    *   **문제:** 비회원 예매 완료 후 AccessCode가 프론트엔드로 전달되지 않아 조회가 불가능했던 현상.
    *   **해결:** 결제 서비스(`ReservationService`)에서 비회원 엔티티를 명시적으로 조회(`NonMemberRepository`)하여 AccessCode를 확실하게 반환하도록 수정.

*   **소셜 로그인 상태 동기화**
    *   **문제:** 소셜 로그인 성공 후에도 헤더가 비로그인 상태로 유지되던 문제.
    *   **해결:** `OAuthCallback`에서 `authChange` 이벤트를 발생시켜 헤더 컴포넌트가 즉시 상태를 갱신하도록 개선.

*   **정렬(Sorting) 및 데이터 매핑 오류 수정**
    *   **문제:** 관리자 페이지 정렬 기능이 동작하지 않음 (하드코딩된 `ORDER BY`가 동적 정렬을 덮어씀).
    *   **해결:** JPQL 쿼리에서 고정된 정렬 조건을 제거하고 `Pageable`을 통한 동적 정렬만 적용되도록 수정.

## 2. 주요 기능 고도화 (Enhancements)

*   **관리자 모니터링 시스템 구축 (`/admin`)**
    *   **대시보드:** 실시간 매출액 및 예매 티켓 수 집계.
    *   **스케줄 관리:** 날짜별 열차 운행 스케줄 조회, 필터링, 페이징 기능.
    *   **티켓 예매 현황:** 실시간 예매 내역 모니터링, 정렬 기능, 사용자 상세 정보 모달 제공.
    *   **UI 개선:** 클라이언트와 분리된 전용 헤더(Dark Theme) 및 고정 레이아웃 테이블 적용.

*   **예약 프로세스 개선**
    *   **매진(Sold Out) 로직:** 특정 구간의 예매된 티켓 수와 열차 정원을 비교하여 실시간 매진 처리 및 UI 비활성화.
    *   **임박 열차 예약 제한:** 출발 5분 전 열차에 대해 예약 버튼 비활성화 및 "시간 초과" 표시.
    *   **통합 예약 완료 페이지:** 회원/비회원 모두에게 명확한 예약 정보를 제공하는 `ReservationSuccessPage` 신설.

*   **마이페이지 개선**
    *   **페이징 적용:** 예매 내역이 많을 경우를 대비한 페이지네이션 적용.
    *   **비회원 조회:** 비회원도 예매번호와 비밀번호로 내역을 조회할 수 있는 전용 탭/기능 보강.

## 3. 기술적 개선 (Refactoring)

*   **Frontend Architecture:**
    *   공통 CSS(`App.css`)로 스타일 중앙화 및 중복 코드 제거.
    *   로그인 상태 관리를 위한 이벤트 기반(`authChange`) 통신 구현.
*   **Backend Optimization:**
    *   `TicketRepository`에 `count` 쿼리와 `Fetch Join`을 적절히 사용하여 N+1 문제 방지 및 성능 최적화.
    *   `AdminTicketDto` 등 전용 DTO를 활용하여 API 응답 구조 명확화.
